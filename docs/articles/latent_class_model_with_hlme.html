<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="lcmm">
<title>How to estimate a latent class mixed model using hlme function • lcmm</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to estimate a latent class mixed model using hlme function">
<meta property="og:description" content="lcmm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">lcmm</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/lcmm.html">GET STARTED</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-vignettes">VIGNETTES</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-vignettes">
    <a class="dropdown-item" href="../articles/latent_class_model_with_hlme.html">How to estimate a latent class mixed model using hlme function</a>
    <a class="dropdown-item" href="../articles/latent_process_model_with_lcmm.html">How to estimate a latent process mixed model using lcmm function</a>
    <a class="dropdown-item" href="../articles/latent_process_model_with_multlcmm.html">How to estimate a latent process mixed model for multivariate markers using multlcmm function</a>
    <a class="dropdown-item" href="../articles/latent_process_model_with_multlcmm_IRT.html">Continuous-time longitudinal IRT model</a>
    <a class="dropdown-item" href="../articles/joint_latent_class_model_with_Jointlcmm.html">How to estimate a joint latent class mixed model using Jointlcmm function</a>
    <a class="dropdown-item" href="../articles/multivariate_latent_class_model_with_mpjlcmm.html">How to estimate a multivariate latent class mixed model using mpjlcmm function</a>
    <a class="dropdown-item" href="../articles/secondary_model_with_externVar.html">Accounting for latent class assignment uncertainty in subsequent analyses</a>
    <a class="dropdown-item" href="../articles/pre_normalizing.html">Pre-normalizing a dependent variable using lcmm</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/usual_problems.html">FAQ</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">REFERENCE</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">CHANGELOG</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CecileProust-Lima/lcmm/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">

<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to estimate a latent class mixed model using hlme function</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CecileProust-Lima/lcmm/blob/HEAD/vignettes/latent_class_model_with_hlme.Rmd" class="external-link"><code>vignettes/latent_class_model_with_hlme.Rmd</code></a></small>
      <div class="d-none name"><code>latent_class_model_with_hlme.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background-and-definitions">Background and definitions<a class="anchor" aria-label="anchor" href="#background-and-definitions"></a>
</h2>
<p align="justify">
The linear mixed model assumes that the population of N subjects is homogeneous and described at the population level by a unique profile <span class="math inline">\(X_{i}(t)\beta\)</span>. In contrast, the latent class mixed model consists in assuming that the population is heterogeneous and composed of <span class="math inline">\(G\)</span> latent classes of subjects characterized by <span class="math inline">\(G\)</span> mean profiles of trajectories.
</p>
<div class="section level3">
<h3 id="the-latent-class-mixed-model">The latent class mixed model<a class="anchor" aria-label="anchor" href="#the-latent-class-mixed-model"></a>
</h3>
<p align="justify">
</p>
<p>Latent class membership is defined by a discrete random variable <span class="math inline">\(c_{i}\)</span> that equals <span class="math inline">\(g\)</span> if subject <span class="math inline">\(i\)</span> belongs to latent class <span class="math inline">\(g\)</span> (<span class="math inline">\(g\)</span> = 1, …,<span class="math inline">\(G\)</span>). The variable <span class="math inline">\(c_{i}\)</span> is latent; its probability is described using a multinomial logistic model according to covariates <span class="math inline">\(X_{ci}\)</span>:</p>
<p><span class="math inline">\(\pi_{ig}= P(c_{i} = g|X_{ci}) = \frac{\exp(\xi_{0g}+X_{ci}\xi_{1g})}{ \sum_{l=1}^{G}\exp(\xi_{0l}+X_{ci}\xi_{1l})}\)</span></p>
where <span class="math inline">\(\xi_{0g}\)</span> is the intercept for class <span class="math inline">\(g\)</span> and <span class="math inline">\(\xi_{1g}\)</span> is the q1-vector of class-specific parameters associated with the q1-vector of time-independent covariates <span class="math inline">\(X_{ci}\)</span>. For identifiability, <span class="math inline">\(\xi_{0G} = 0\)</span> and <span class="math inline">\(\xi_{1G} = 0\)</span>. When no covariate predicts the latent class membership, this model reduces to a class-specific probability.

<p align="justify">
For a continuous and Gaussian variable, the trajectories of <span class="math inline">\(Y\)</span> are defined conditionally to the latent class by a linear mixed model. So, conditional on class <span class="math inline">\(g\)</span>, the model is defined for subject <span class="math inline">\(i\)</span> at occasion <span class="math inline">\(j\)</span>:
</p>
<p> </p>
<p><span class="math display">\[Y_{ij}|_{c_{i}=g} = X_{2ij}\beta+X_{3ij}\gamma_{g}+Z_{ij}b_{i}+\epsilon_{ij}\]</span></p>
<p> </p>
<p align="justify">
where <span class="math inline">\(X_{2ij}\)</span>, <span class="math inline">\(X_{3ij}\)</span> and <span class="math inline">\(Z_{ij}\)</span> are vectors of covariates respectively associated with common fixed effects over classes <span class="math inline">\(\beta\)</span>, class-specific fixed effects <span class="math inline">\(\gamma_{g}\)</span> and with individual random effects <span class="math inline">\(b_{i}|_{ci=g}\)</span> called <span class="math inline">\(b_{ig}\)</span> whose distributions are now class-specific. <span class="math inline">\(X_{2}\)</span> and <span class="math inline">\(X_{3}\)</span> can’t have common variables.
</p>
</div>
<div class="section level3">
<h3 id="posterior-classification">Posterior classification<a class="anchor" aria-label="anchor" href="#posterior-classification"></a>
</h3>
<p align="justify">
In models involving latent classes, a posterior classification of the subjects in each latent class can be made. It is based on the posterior calculation of the class-membership probabilities and is used to characterize the classification of the subjects as well as to evaluate the goodness-of-fit of the model (Proust-Lima et al. 2014 - <a href="https://doi.org/10.1177/0962280212445839" class="external-link uri">https://doi.org/10.1177/0962280212445839</a> ).
</p>
<p align="justify">
Posterior class-membership probabilities are computed using the Bayes theorem as the probability of belonging to a latent class given the information collected. In a longitudinal model, they are defined for subject <span class="math inline">\(i\)</span> and latent class <span class="math inline">\(g\)</span> as:
</p>
<p> </p>
<p><span class="math display">\[\hat{\pi}_{ig}^Y=P(c_{i}=g|X_{i},Y_{i},\hat{\theta}_{G})\]</span></p>
<p><em>where :</em> <span class="math inline">\(\hat{\theta}_{G}\)</span> is the vector of parameters estimated in the <span class="math inline">\(G\)</span> latent class model.</p>
<p> </p>
<p> </p>
</div>
</div>
<div class="section level2">
<h2 id="example-for-gaussian-data">Example for Gaussian Data<a class="anchor" aria-label="anchor" href="#example-for-gaussian-data"></a>
</h2>
<p align="justify">
In this example, we study the quadratic trajectory of a cognitive marker, the Mini Mental State Examination (<strong>MMSE</strong>) pre-normalized (to have a Gaussian distribution) in a sample of old people (aged 65 years old and over at inclusion) followed for up to 15 years with an adjustment on education level. The model does not consider interactions here although any regression may be considered.
</p>
<div class="section level3">
<h3 id="model-considered">Model considered<a class="anchor" aria-label="anchor" href="#model-considered"></a>
</h3>
<p align="justify">
We consider the following latent class linear mixed model, where <span class="math inline">\(g\)</span> denotes the class, <span class="math inline">\(i\)</span> the subject and <span class="math inline">\(j\)</span> the repeated measurement:
</p>
<p> </p>
<p><span class="math display">\[normMMSE_{ij}|_{c_{i}=g}=\beta_{0g}+\beta_{1g}age_{ij}+\beta_{2g}age_{ij}^2+\beta_{3}CEP_{i}+u_{0ig}+u_{1ig}age_{ij}+u_{2ig}age_{ij}^2+\epsilon_{ij}\]</span></p>
<p> </p>
<p><em>Where :</em> <span class="math inline">\(u_{ig} \sim \mathcal{N}(0,B_{g})\)</span> and <span class="math inline">\(\epsilon_{ij} \sim \mathcal{N}(0,\sigma^2)\)</span></p>
<p> </p>
<p>The <em>Fixed part</em> is <span class="math inline">\(\beta_{0g}+\beta_{1g}age_{ij}+\beta_{2g}age_{ij}^2+\beta_{3}CEP_{i}\)</span> with a mixture on <span class="math inline">\(age_{ij}\)</span> and <span class="math inline">\(age_{ij}^2\)</span>; the <em>random part</em> is <span class="math inline">\(u_{0ig}+u_{1ig}age_{ij}+u_{2ig}age_{ij}^2\)</span>,</p>
<p> </p>
</div>
<div class="section level3">
<h3 id="dependent-variable-normalized-mmse">Dependent variable: normalized MMSE<a class="anchor" aria-label="anchor" href="#dependent-variable-normalized-mmse"></a>
</h3>
<p> </p>
<p align="justify">
As MMSE has a very skewed distribution, we use its normalized version easily obtained from NormPsy package (see <a href="lcmm.html">Introduction vignette</a>).
</p>
<p> </p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">NormPsy</span><span class="op">)</span></span>
<span><span class="va">paquid</span><span class="op">$</span><span class="va">normMMSE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/NormPsy/man/normMMSE.html" class="external-link">normMMSE</a></span><span class="op">(</span><span class="va">paquid</span><span class="op">$</span><span class="va">MMSE</span><span class="op">)</span></span></code></pre></div>
<p> </p>
</div>
<div class="section level3">
<h3 id="estimate-the-model-with-only-one-class-g1">Estimate the model with only one class (G=1)<a class="anchor" aria-label="anchor" href="#estimate-the-model-with-only-one-class-g1"></a>
</h3>
<p>Analysis is done according to age. To avoid any numerical problems, we recenter and scale age:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">paquid</span><span class="op">$</span><span class="va">age65</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">paquid</span><span class="op">$</span><span class="va">age</span> <span class="op">-</span> <span class="fl">65</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span></span></code></pre></div>
<p> </p>
<p>We fit the linear mixed model for normMMSE:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">normMMSE</span> <span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">CEP</span>,random <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, subject <span class="op">=</span> <span class="st">'ID'</span>, data <span class="op">=</span> <span class="va">paquid</span><span class="op">)</span> <span class="co"># ng=1</span></span></code></pre></div>
<p>&amp;nbsp</p>
</div>
<div class="section level3">
<h3 id="estimate-the-model-with-more-than-one-class-g-1">Estimate the model with more than one class (G &gt; 1)<a class="anchor" aria-label="anchor" href="#estimate-the-model-with-more-than-one-class-g-1"></a>
</h3>
<p align="justify">
From the model estimated by assuming a single latent class, we can now search for heterogeneous profiles. The next lines provide the estimation of the model for 2 latent classes using the automatic specification for the initial values when <span class="math inline">\(G&gt;1\)</span>.
</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Estimation considering 2 classes : </span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">normMMSE</span> <span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">CEP</span>, random <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, subject <span class="op">=</span> <span class="st">'ID'</span>, data <span class="op">=</span> <span class="va">paquid</span>, ng <span class="op">=</span> <span class="fl">2</span>, mixture<span class="op">=</span><span class="op">~</span><span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, B<span class="op">=</span><span class="va">m1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="be-careful-with-initial-values">Be careful with initial values !<a class="anchor" aria-label="anchor" href="#be-careful-with-initial-values"></a>
</h3>
<p align="justify">
Initial values are specified in argument <code>B</code>. The option <code>B=m1</code> automatically generates initial values from the maximum likelihood estimates of a 1-class model (here, <code>m1</code>). Not specifying <code>B</code> or specifying <code>B=NULL</code> is not recommended since it induces the internal pre-estimation of the model with <span class="math inline">\(G = 1\)</span> (i.e <code>m1</code>) which may substantially increase computational time.
</p>
<p> </p>
<div class="section level4">
<h4 id="values-pre-specified-by-the-user">Values pre-specified by the user<a class="anchor" aria-label="anchor" href="#values-pre-specified-by-the-user"></a>
</h4>
<p align="justify">
In the following example, the initial values are pre-specified by the user: parameters of the variance covariance were taken at the estimated values of the linear mixed model and arbitrary initial values were tried for the class-specific trajectories:
</p>
<p> </p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">normMMSE</span> <span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">CEP</span>, random <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, subject <span class="op">=</span> <span class="st">'ID'</span>,data <span class="op">=</span> <span class="va">paquid</span>, ng <span class="op">=</span> <span class="fl">2</span>, mixture <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span>, <span class="fl">40</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">4</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">10</span>, <span class="fl">10</span>, <span class="fl">212.869397</span>, <span class="op">-</span><span class="fl">216.421323</span>,<span class="fl">456.229910</span>, <span class="fl">55.713775</span>, <span class="op">-</span><span class="fl">145.715516</span>, <span class="fl">59.351000</span>, <span class="fl">10.072221</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="values-randomly-generated">Values randomly generated<a class="anchor" aria-label="anchor" href="#values-randomly-generated"></a>
</h4>
<p align="justify">
An alternative is to randomly generate the initial values from the asymptotic distribution of the estimates of the 1-class model (here, <code>m1</code>):
</p>
<p> </p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">normMMSE</span> <span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">CEP</span>, random <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,subject <span class="op">=</span> <span class="st">'ID'</span>, data <span class="op">=</span> <span class="va">paquid</span>, ng <span class="op">=</span> <span class="fl">2</span>, mixture <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,  B <span class="op">=</span> <span class="fu">random</span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="grid-search">Grid search<a class="anchor" aria-label="anchor" href="#grid-search"></a>
</h4>
<p align="justify">
Finally, gridsearch function can be used to run an automatic grid search. In the next examples with <span class="math inline">\(G=2\)</span> and <span class="math inline">\(G=3\)</span> classes (<code>m2d</code> and <code>m3b</code>, respectively), <code>hlme</code> is run for a maximum of 30 iterations from 100 random vectors of initial values. The estimation procedure is then finalized only for the departure that provided the best log-likelihood after 30 iterations.
</p>
<p> </p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridsearch.html">gridsearch</a></span><span class="op">(</span><span class="fu"><a href="../reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">normMMSE</span> <span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">CEP</span>,  random <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, subject <span class="op">=</span> <span class="st">'ID'</span>, data<span class="op">=</span><span class="va">paquid</span>, ng <span class="op">=</span> <span class="fl">2</span>, mixture<span class="op">=</span><span class="op">~</span><span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, rep<span class="op">=</span><span class="fl">100</span>, maxiter<span class="op">=</span><span class="fl">30</span>, minit<span class="op">=</span><span class="va">m1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gridsearch.html">gridsearch</a></span><span class="op">(</span><span class="fu"><a href="../reference/hlme.html">hlme</a></span><span class="op">(</span><span class="va">normMMSE</span> <span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span><span class="va">CEP</span>,  random <span class="op">=</span><span class="op">~</span> <span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, subject <span class="op">=</span> <span class="st">'ID'</span>, data<span class="op">=</span><span class="va">paquid</span>, ng <span class="op">=</span> <span class="fl">3</span>, mixture<span class="op">=</span><span class="op">~</span><span class="va">age65</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">age65</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>, rep<span class="op">=</span><span class="fl">100</span>, maxiter<span class="op">=</span><span class="fl">30</span>, minit<span class="op">=</span><span class="va">m1</span><span class="op">)</span></span></code></pre></div>
<p>This method is recommended as it enables to better explore the parameter space when the number of replicates is large enough and the number of iterations is fairly large.</p>
</div>
</div>
<div class="section level3">
<h3 id="choose-the-best-model">Choose the best model<a class="anchor" aria-label="anchor" href="#choose-the-best-model"></a>
</h3>
<p> </p>
<p align="justify">
The estimation process of a set of models (usually with a varying number of latent classes) can be summarized with <code>summarytable</code> and plotted with <code>summaryplot</code>. Different information can be displayed:
</p>
<p> </p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">summarytable</span>(m1,m2,m2b,m2c, m2d  , m3g, <span class="dt">which =</span> <span class="kw">c</span>(<span class="st">"G"</span>, <span class="st">"loglik"</span>, <span class="st">"conv"</span>, <span class="st">"npm"</span>, <span class="st">"AIC"</span>, <span class="st">"BIC"</span>, <span class="st">"SABIC"</span>, <span class="st">"entropy"</span>,<span class="st">"ICL"</span>, <span class="st">"%class"</span>))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">    G    loglik conv npm      AIC      BIC    SABIC   entropy     ICL1     ICL2</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">m1  <span class="dv">1</span> <span class="fl">-8920.623</span>    <span class="dv">1</span>  <span class="dv">11</span> <span class="fl">17863.25</span> <span class="fl">17909.61</span> <span class="fl">17874.69</span> <span class="fl">1.0000000</span> <span class="fl">17909.61</span> <span class="fl">17909.61</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4">m2  <span class="dv">2</span> <span class="fl">-8899.228</span>    <span class="dv">1</span>  <span class="dv">15</span> <span class="fl">17828.46</span> <span class="fl">17891.67</span> <span class="fl">17844.06</span> <span class="fl">0.5504369</span> <span class="fl">18047.48</span> <span class="fl">18050.54</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">m2b <span class="dv">2</span> <span class="fl">-8899.228</span>    <span class="dv">1</span>  <span class="dv">15</span> <span class="fl">17828.46</span> <span class="fl">17891.67</span> <span class="fl">17844.06</span> <span class="fl">0.5504366</span> <span class="fl">18047.48</span> <span class="fl">18050.54</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6">m2c <span class="dv">2</span> <span class="fl">-8899.228</span>    <span class="dv">1</span>  <span class="dv">15</span> <span class="fl">17828.46</span> <span class="fl">17891.67</span> <span class="fl">17844.06</span> <span class="fl">0.5504369</span> <span class="fl">18047.48</span> <span class="fl">18050.54</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">m2d <span class="dv">2</span> <span class="fl">-8899.228</span>    <span class="dv">1</span>  <span class="dv">15</span> <span class="fl">17828.46</span> <span class="fl">17891.67</span> <span class="fl">17844.06</span> <span class="fl">0.5504370</span> <span class="fl">18047.48</span> <span class="fl">18050.54</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8">m3g <span class="dv">3</span> <span class="fl">-8891.351</span>    <span class="dv">1</span>  <span class="dv">19</span> <span class="fl">17820.70</span> <span class="fl">17900.78</span> <span class="fl">17840.47</span> <span class="fl">0.6240325</span> <span class="fl">18107.30</span> <span class="fl">18089.55</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    <span class="op">%class1 %</span>class2 %class3</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">m1    <span class="fl">100.0</span>                </a>
<a class="sourceLine" id="cb9-11" data-line-number="11">m2     <span class="fl">12.4</span>    <span class="fl">87.6</span>        </a>
<a class="sourceLine" id="cb9-12" data-line-number="12">m2b    <span class="fl">87.6</span>    <span class="fl">12.4</span>        </a>
<a class="sourceLine" id="cb9-13" data-line-number="13">m2c    <span class="fl">12.4</span>    <span class="fl">87.6</span>        </a>
<a class="sourceLine" id="cb9-14" data-line-number="14">m2d    <span class="fl">12.4</span>    <span class="fl">87.6</span>        </a>
<a class="sourceLine" id="cb9-15" data-line-number="15">m3g    <span class="fl">85.8</span>     <span class="fl">4.0</span>    <span class="fl">10.2</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="kw">summaryplot</span>(m1, m2, m3g, <span class="dt">which =</span> <span class="kw">c</span>(<span class="st">"BIC"</span>, <span class="st">"entropy"</span>,<span class="st">"ICL"</span>))</a></code></pre></div>
<p><img src="latent_class_model_with_hlme_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p> </p>
<p align="justify">
</p>
<p>We summarize here the 6 models we previously estimated. We can see that all the 2-class models converged at the same estimation point. Only the order of the classes is changed. This phenomenon called “label switching” often happens. <strong>It is not a problem: this is the exact same optimum</strong>.</p>
This example illustrates the complexity to define the “optimal number of latent classes”. Indeed, according to recommended BIC, the 2 class model should be retained (as it provides the lowest value). But both the AIC and Size adjusted BIC (which involve smaller penalties) favor the 3-class model. The entropy also favors the 3-class model as having a better discriminatory power (entropy closer to 1). Finally, the 3-class model creates a very very small class, which is usually not the kind of heterogeneity ones searches for and is interested in. In this example, depending on the statistical and clinical criteria, either the 2- or the 3-class model could be retained. Below, we retained the 2-class model for the final output description.

<p> </p>
</div>
<div class="section level3">
<h3 id="description-of-the-2-class-linear-mixed-model">Description of the 2-class linear mixed model<a class="anchor" aria-label="anchor" href="#description-of-the-2-class-linear-mixed-model"></a>
</h3>
<div class="section level4">
<h4 id="summary-of-the-model">Summary of the model<a class="anchor" aria-label="anchor" href="#summary-of-the-model"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">summary</span>(m2d)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">Heterogenous linear mixed model </a>
<a class="sourceLine" id="cb10-3" data-line-number="3">     fitted by maximum likelihood method </a>
<a class="sourceLine" id="cb10-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw">hlme</span>(<span class="dt">fixed =</span> normMMSE <span class="op">~</span><span class="st"> </span>age65 <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>CEP, <span class="dt">mixture =</span> <span class="op">~</span>age65 <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="st">    </span><span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>), <span class="dt">random =</span> <span class="op">~</span>age65 <span class="op">+</span><span class="st"> </span><span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>), <span class="dt">subject =</span> <span class="st">"ID"</span>, </a>
<a class="sourceLine" id="cb10-7" data-line-number="7">    <span class="dt">ng =</span> <span class="dv">2</span>, <span class="dt">data =</span> paquid)</a>
<a class="sourceLine" id="cb10-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb10-9" data-line-number="9">Statistical Model<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="st">     </span>Dataset<span class="op">:</span><span class="st"> </span>paquid </a>
<a class="sourceLine" id="cb10-11" data-line-number="11">     Number of subjects<span class="op">:</span><span class="st"> </span><span class="dv">500</span> </a>
<a class="sourceLine" id="cb10-12" data-line-number="12">     Number of observations<span class="op">:</span><span class="st"> </span><span class="dv">2214</span> </a>
<a class="sourceLine" id="cb10-13" data-line-number="13">     Number of observations deleted<span class="op">:</span><span class="st"> </span><span class="dv">36</span> </a>
<a class="sourceLine" id="cb10-14" data-line-number="14">     Number of latent classes<span class="op">:</span><span class="st"> </span><span class="dv">2</span> </a>
<a class="sourceLine" id="cb10-15" data-line-number="15">     Number of parameters<span class="op">:</span><span class="st"> </span><span class="dv">15</span>  </a>
<a class="sourceLine" id="cb10-16" data-line-number="16"> </a>
<a class="sourceLine" id="cb10-17" data-line-number="17">Iteration process<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="st">     </span>Convergence criteria satisfied </a>
<a class="sourceLine" id="cb10-19" data-line-number="19">     Number of iterations<span class="op">:</span><span class="st">  </span><span class="dv">1</span> </a>
<a class="sourceLine" id="cb10-20" data-line-number="20">     Convergence criteria<span class="op">:</span><span class="st"> </span>parameters=<span class="st"> </span><span class="fl">1.5e-10</span> </a>
<a class="sourceLine" id="cb10-21" data-line-number="21">                         <span class="op">:</span><span class="st"> </span>likelihood=<span class="st"> </span><span class="fl">2e-11</span> </a>
<a class="sourceLine" id="cb10-22" data-line-number="22">                         <span class="op">:</span><span class="st"> </span>second derivatives=<span class="st"> </span><span class="fl">1.9e-13</span> </a>
<a class="sourceLine" id="cb10-23" data-line-number="23"> </a>
<a class="sourceLine" id="cb10-24" data-line-number="24">Goodness<span class="op">-</span>of<span class="op">-</span>fit statistics<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-25" data-line-number="25"><span class="st">     </span>maximum log<span class="op">-</span>likelihood<span class="op">:</span><span class="st"> </span><span class="fl">-8899.23</span>  </a>
<a class="sourceLine" id="cb10-26" data-line-number="26">     AIC<span class="op">:</span><span class="st"> </span><span class="fl">17828.46</span>  </a>
<a class="sourceLine" id="cb10-27" data-line-number="27">     BIC<span class="op">:</span><span class="st"> </span><span class="fl">17891.67</span>  </a>
<a class="sourceLine" id="cb10-28" data-line-number="28"> </a>
<a class="sourceLine" id="cb10-29" data-line-number="29"> </a>
<a class="sourceLine" id="cb10-30" data-line-number="30">Maximum Likelihood Estimates<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-31" data-line-number="31"><span class="st"> </span></a>
<a class="sourceLine" id="cb10-32" data-line-number="32">Fixed effects <span class="cf">in</span> the class<span class="op">-</span>membership model<span class="op">:</span></a>
<a class="sourceLine" id="cb10-33" data-line-number="33">(the class of reference is the last class) </a>
<a class="sourceLine" id="cb10-34" data-line-number="34"></a>
<a class="sourceLine" id="cb10-35" data-line-number="35">                       coef      Se     Wald p<span class="op">-</span>value</a>
<a class="sourceLine" id="cb10-36" data-line-number="36">intercept class1   <span class="fl">-1.31806</span> <span class="fl">0.23136</span>   <span class="fl">-5.697</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb10-37" data-line-number="37"></a>
<a class="sourceLine" id="cb10-38" data-line-number="38">Fixed effects <span class="cf">in</span> the longitudinal model<span class="op">:</span></a>
<a class="sourceLine" id="cb10-39" data-line-number="39"></a>
<a class="sourceLine" id="cb10-40" data-line-number="40"><span class="st">                        </span>coef      Se     Wald p<span class="op">-</span>value</a>
<a class="sourceLine" id="cb10-41" data-line-number="41">intercept class1    <span class="fl">64.03287</span> <span class="fl">5.96887</span>   <span class="fl">10.728</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb10-42" data-line-number="42">intercept class2    <span class="fl">63.55487</span> <span class="fl">2.34057</span>   <span class="fl">27.154</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb10-43" data-line-number="43">age65 class1        <span class="fl">17.97202</span> <span class="fl">9.16299</span>    <span class="fl">1.961</span> <span class="fl">0.04984</span></a>
<a class="sourceLine" id="cb10-44" data-line-number="44">age65 class2         <span class="fl">3.55149</span> <span class="fl">3.20467</span>    <span class="fl">1.108</span> <span class="fl">0.26777</span></a>
<a class="sourceLine" id="cb10-45" data-line-number="45"><span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>) class1  <span class="fl">-16.30143</span> <span class="fl">2.63069</span>   <span class="fl">-6.197</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb10-46" data-line-number="46"><span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>) class2   <span class="fl">-3.81582</span> <span class="fl">1.00282</span>   <span class="fl">-3.805</span> <span class="fl">0.00014</span></a>
<a class="sourceLine" id="cb10-47" data-line-number="47">CEP                 <span class="fl">14.11146</span> <span class="fl">1.33668</span>   <span class="fl">10.557</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb10-48" data-line-number="48"></a>
<a class="sourceLine" id="cb10-49" data-line-number="49"></a>
<a class="sourceLine" id="cb10-50" data-line-number="50">Variance<span class="op">-</span>covariance matrix of the random<span class="op">-</span>effects<span class="op">:</span></a>
<a class="sourceLine" id="cb10-51" data-line-number="51"><span class="st">            </span>intercept     age65 <span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb10-52" data-line-number="52">intercept   <span class="fl">221.24245</span>                     </a>
<a class="sourceLine" id="cb10-53" data-line-number="53">age65      <span class="fl">-228.32072</span>  <span class="fl">429.3370</span>           </a>
<a class="sourceLine" id="cb10-54" data-line-number="54"><span class="kw">I</span>(age65<span class="op">^</span><span class="dv">2</span>)   <span class="fl">62.02014</span> <span class="fl">-121.0904</span>   <span class="fl">36.73242</span></a>
<a class="sourceLine" id="cb10-55" data-line-number="55"></a>
<a class="sourceLine" id="cb10-56" data-line-number="56">                               coef      Se</a>
<a class="sourceLine" id="cb10-57" data-line-number="57">Residual standard error<span class="op">:</span><span class="st">   </span><span class="fl">10.05486</span> <span class="fl">0.20136</span></a></code></pre></div>
</div>
<div class="section level4">
<h4 id="predictions-of-the-trajectories">Predictions of the trajectories<a class="anchor" aria-label="anchor" href="#predictions-of-the-trajectories"></a>
</h4>
<p align="justify">
Class-specific predictions can be computed for any data contained in a dataframe as soon as all the covariates specified in the model are included in the dataframe. In the next lines, such a dataframe is created by generating a vector of <span class="math inline">\(age\)</span> values between 65 and 95 and defining <span class="math inline">\(CEP\)</span> at 1 or 0. The predictions are computed with <code>predictY</code> and plotted with the associated <code>plot</code> functionality or by using standard R tools.
</p>
<p> </p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_pred0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">65</span>,<span class="fl">95</span>,length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,CEP<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">data_pred1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>age<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">65</span>,<span class="fl">95</span>,length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,CEP<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">data_pred0</span><span class="op">$</span><span class="va">age65</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data_pred0</span><span class="op">$</span><span class="va">age</span> <span class="op">-</span> <span class="fl">65</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span></span>
<span><span class="va">data_pred1</span><span class="op">$</span><span class="va">age65</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">data_pred1</span><span class="op">$</span><span class="va">age</span> <span class="op">-</span> <span class="fl">65</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span></span></code></pre></div>
<p> </p>
<p>Predictions are computed for each class at the point estimate:</p>
<p> </p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">m2d</span>, <span class="va">data_pred0</span>, var.time <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="va">pred1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">m2d</span>, <span class="va">data_pred1</span>, var.time <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<p>Predictions can then be plotted:</p>
<p> </p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pred0</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"navy"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>,lwd<span class="op">=</span><span class="fl">5</span>,ylab<span class="op">=</span><span class="st">"normMMSE"</span>,legend<span class="op">=</span><span class="cn">NULL</span>,  main<span class="op">=</span><span class="st">"Predicted trajectories for normMMSE "</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pred1</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"navy"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span>,lwd<span class="op">=</span><span class="fl">3</span>,legend<span class="op">=</span><span class="cn">NULL</span>,add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"topright"</span>,legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"class1 :"</span>,<span class="st">"CEP-"</span>,<span class="st">"CEP+"</span>,<span class="st">"class2:"</span>,<span class="st">"CEP-"</span>,<span class="st">"CEP+"</span><span class="op">)</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="fl">3</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"navy"</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span>, lwd<span class="op">=</span><span class="fl">2</span>, lty<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">2</span>, bty<span class="op">=</span><span class="st">"n"</span>, cex <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="latent_class_model_with_hlme_files/figure-html/unnamed-chunk-15-1.png" width="576"></p>
<p> </p>
<p>If we want to have a sense of the variability, we can compute the predictions with confidence intervals and plot them:</p>
<p> </p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predIC0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">m2d</span>, <span class="va">data_pred0</span>, var.time <span class="op">=</span> <span class="st">"age"</span>,draws<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">predIC1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">m2d</span>, <span class="va">data_pred1</span>, var.time <span class="op">=</span> <span class="st">"age"</span>,draws<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predIC0</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deeppink"</span>,<span class="st">"deepskyblue"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylab<span class="op">=</span><span class="st">"normMMSE"</span>, main<span class="op">=</span><span class="st">"Predicted trajectories for normMMSE"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, shades<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predIC1</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"deeppink"</span>,<span class="st">"deepskyblue"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">2</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylab<span class="op">=</span><span class="st">"normMMSE"</span>, main<span class="op">=</span><span class="st">"Predicted trajectories for normMMSE"</span>, legend<span class="op">=</span><span class="cn">NULL</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, shades<span class="op">=</span><span class="cn">TRUE</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="latent_class_model_with_hlme_files/figure-html/unnamed-chunk-16-1.png" width="576"></p>
<p> </p>
<p>Finally, the predicted trajectories for 1-, 2- and 3-class models can be represented together in the following graph:</p>
<p> </p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predG1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">m1</span>, <span class="va">data_pred0</span>, var.time <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span><span class="va">predG3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predictY.html">predictY</a></span><span class="op">(</span><span class="va">m3g</span>, <span class="va">data_pred0</span>, var.time <span class="op">=</span> <span class="st">"age"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predG1</span>, col<span class="op">=</span><span class="fl">1</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylab<span class="op">=</span><span class="st">"normMMSE"</span>, legend<span class="op">=</span><span class="cn">NULL</span>, main<span class="op">=</span><span class="st">"Predicted trajectories G=1"</span>,ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">pred0</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"navy"</span><span class="op">)</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span>,ylab<span class="op">=</span><span class="st">"normMMSE"</span>, legend<span class="op">=</span><span class="cn">NULL</span>, main<span class="op">=</span><span class="st">"Predicted trajectories G=2"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">predG3</span>, col<span class="op">=</span><span class="fl">2</span><span class="op">:</span><span class="fl">4</span>, lty<span class="op">=</span><span class="fl">1</span>, lwd<span class="op">=</span><span class="fl">2</span>, ylab<span class="op">=</span><span class="st">"normMMSE"</span>, legend<span class="op">=</span><span class="cn">NULL</span>, main<span class="op">=</span><span class="st">"Predicted trajectories G=3"</span>, ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="latent_class_model_with_hlme_files/figure-html/unnamed-chunk-17-1.png" width="960"></p>
<p> </p>
</div>
</div>
<div class="section level3">
<h3 id="evaluation-of-the-final-latent-class-mixed-model">Evaluation of the final latent class mixed model<a class="anchor" aria-label="anchor" href="#evaluation-of-the-final-latent-class-mixed-model"></a>
</h3>
<div class="section level4">
<h4 id="plot-of-the-residuals">Plot of the residuals<a class="anchor" aria-label="anchor" href="#plot-of-the-residuals"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m2d</span>, cex.main<span class="op">=</span><span class="fl">0.8</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="graph-of-the-predictions-versus-observations">Graph of the predictions versus observations<a class="anchor" aria-label="anchor" href="#graph-of-the-predictions-versus-observations"></a>
</h4>
<p> </p>
<p align="justify">
In order to evaluate the fit of the selected model, we plot simultaneously the observations and the predicted values for each latent class.
</p>
<p> </p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot.html">plot</a></span><span class="op">(</span><span class="va">m2d</span>, which<span class="op">=</span><span class="st">"fit"</span>, var.time<span class="op">=</span><span class="st">"age"</span>, marg<span class="op">=</span><span class="cn">FALSE</span>, shades <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="latent_class_model_with_hlme_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
<p>The graph shows here the very good fit to the data.  </p>
</div>
<div class="section level4">
<h4 id="classification">Classification<a class="anchor" aria-label="anchor" href="#classification"></a>
</h4>
<p>The posterior classification of the model is obtained with:</p>
<p> </p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">postprob</span>(m2d) </a>
<a class="sourceLine" id="cb18-2" data-line-number="2"> </a>
<a class="sourceLine" id="cb18-3" data-line-number="3">Posterior classification<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-4" data-line-number="4"><span class="st">  </span>class1 class2</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">N   <span class="fl">62.0</span>  <span class="fl">438.0</span></a>
<a class="sourceLine" id="cb18-6" data-line-number="6">%   <span class="fl">12.4</span>   <span class="fl">87.6</span></a>
<a class="sourceLine" id="cb18-7" data-line-number="7"> </a>
<a class="sourceLine" id="cb18-8" data-line-number="8">Posterior classification table<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-9" data-line-number="9"><span class="st">     </span><span class="op">-</span>-&gt;<span class="st"> </span>mean of posterior probabilities <span class="cf">in</span> each class </a>
<a class="sourceLine" id="cb18-10" data-line-number="10">        prob1  prob2</a>
<a class="sourceLine" id="cb18-11" data-line-number="11">class1 <span class="fl">0.8054</span> <span class="fl">0.1946</span></a>
<a class="sourceLine" id="cb18-12" data-line-number="12">class2 <span class="fl">0.1270</span> <span class="fl">0.8730</span></a>
<a class="sourceLine" id="cb18-13" data-line-number="13"> </a>
<a class="sourceLine" id="cb18-14" data-line-number="14">Posterior probabilities above a <span class="kw">threshold</span> (%)<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb18-15" data-line-number="15"><span class="st">         </span>class1 class2</a>
<a class="sourceLine" id="cb18-16" data-line-number="16">prob<span class="op">&gt;</span><span class="fl">0.7</span>  <span class="fl">61.29</span>  <span class="fl">90.18</span></a>
<a class="sourceLine" id="cb18-17" data-line-number="17">prob<span class="op">&gt;</span><span class="fl">0.8</span>  <span class="fl">58.06</span>  <span class="fl">69.18</span></a>
<a class="sourceLine" id="cb18-18" data-line-number="18">prob<span class="op">&gt;</span><span class="fl">0.9</span>  <span class="fl">43.55</span>  <span class="fl">47.95</span></a>
<a class="sourceLine" id="cb18-19" data-line-number="19"> </a></code></pre></div>
<p> </p>
<p align="justify">
</p>
<p><code>Class 1</code> is composed of 62 subjects (12.4%), whereas 438 are in the second class.</p>
<p>We can also see information about the discrimination power of the model with:</p>
<ul>
<li><p>the posterior classification table: subjects classified in <code>class 1</code> (resp. <code>class 2</code>) have a mean probability of 0.8054 (resp. 0.8730) to belong to this class. This show good discrimination of the classes.</p></li>
<li>the proportion of classified subjects above a threshold: here 90.18% (resp. 61.29%) of subjects in class 1 (resp. 2) are classified in the class with a posterior probability greater than 70%.
</li>
</ul>
</div>
</div>
</div>
<div class="section level2">
<h2 id="examples-with-other-types-of-dependent-variables">Examples with other types of dependent variables<a class="anchor" aria-label="anchor" href="#examples-with-other-types-of-dependent-variables"></a>
</h2>
<p>Latent class mixed models can be estimated for other types of data within lcmm R package:</p>
<ul>
<li><p>with lcmm function for not necessarily Gaussian longitudinal marker</p></li>
<li><p>with multlcmm function for multiple longitudinal markers measuring the same underlying latent process</p></li>
<li><p>with Jointlcmm (or shortcut jlcmm) function for longitudinal markers measuring a unique longitudinal dimension and time to event (possibly with competing risks)</p></li>
<li><p>with mpjlcmm function for multivariate longitudinal dimensions (i.e., markers or processes measured by several markers) and time to event (possibly with competing risks)</p></li>
<li><p>with other functions to come … !</p></li>
</ul>
<p>Each time, the same functions (e.g., summarytable, gridsearch, postprob, predictY) apply exactly in the same way.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Cecile Proust-Lima, Viviane Philipps.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
